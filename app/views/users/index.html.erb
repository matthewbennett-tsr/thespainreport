<% title 'All Members' %>
<div class="content-left-new-page"> <%# LEFT-HAND MAIN CONTENT BLOCK %>
<div class="content-white-background">

<h1>All Members</h1>

<div class="article-lede">
- <%= @totalsubscribers %> total subscribers <br />
- <%= @onestorysubscribers %> single-story subscribers <br />
- <%= @allstorysubscribers %> all-story subscribers <br />
- <%= @straysubscribercount %> non subscribers <br />
- <%= @readercount %> readers <br />
- <%= @guestcount %> guests
</div>

  <%= form_tag(users_path, :method => "get", id: "search-form") do %>
    <div style="float:left;">
      <%= text_field_tag :search, params[:search], :size => 50, placeholder: "Search Stories" %>
    </div>
    <div style="float:left; margin-left: 10px;">
      <%= submit_tag "Search" %>
    </div>
    <div class="clear"></div>
  <% end %>

<% unless params[:search] %>
<h3>Latest Subscribers</h3>

<table class="admin-table">
  <thead>
    <tr style="font-weight: bold;">
      <td></td>
      <td>Joined</td>
      <td>Role</td>
      <td>E-mail</td>
      <td>Confirm</td>
      <td>Stripe ID</td>
      <td></td>
    </tr>
  </thead>

  <tbody>
    <% User.all.each do |user| %>
      <tr>
        <td><%= link_to 'E', edit_user_path(user) %></td>
        <td><%= user.created_at.strftime("%d/%m/%Y") %></td>
        <td>
        <% if user.role == 'editor' %>
            <span class="editor-label-mini">
          <% elsif ['subscriber', 'subscriber_one_story', 'subscriber_all_stories'].include?(user.role) %>
            <span class="subscriber-label-mini">
          <% elsif user.role == 'reader' %>
            <span class="reader-label-mini">
          <% else %>
            <span>
          <% end %>
        <%= user.role.to_s.titleize %></span>
        </td>
        <td><%= mail_to user.email %></td>
        <td><%= user.email_confirmed %></td>
        <td style="padding: 0px 1px;"><% if user.stripe_customer_id.present? %><%= user.stripe_customer_id %><% end %></td>
        <td><%= link_to 'D?', user, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<h3>Latest Readers</h3>

<table class="admin-table">
  <thead>
    <tr style="font-weight: bold;">
      <td></td>
      <td>Joined</td>
      <td>Role</td>
      <td>E-mail</td>
      <td>Confirm</td>
      <td>URL</td>
      <td></td>
    </tr>
  </thead>

  <tbody>
    <% @latestusers.each do |user| %>
      <tr>
        <td><%= link_to 'E', edit_user_path(user) %></td>
        <td><%= user.created_at.strftime("%d/%m/%Y") %></td>
        <td>
        <% if user.role == 'editor' %>
            <span class="editor-label-mini">
          <% elsif user.role == 'subscriber' %>
            <span class="subscriber-label-mini">
          <% elsif user.role == 'reader' %>
            <span class="reader-label-mini">
          <% else %>
            <span>
          <% end %>
        <%= user.role.to_s.humanize %></span>
        </td>
        <td><%= mail_to truncate(user.email, :length => 20) %></td>
        <td><%= user.email_confirmed %></td>
        <td>
          <% user.articles.each do |a| %>
           <%= link_to truncate(a.headline, :length => 20), a %>
          <% end %>
        </td>
        <td><%= link_to 'D?', user, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<% end %>

</div>
</div>